@page "/meddy-explorer"
@using MeddyExplorerApp.Objects
@inject MeddyExplorerSessionInfo meddyExplorerSessionInfo

<MEACurrentDirTextField />
<MEACurrentDirFilesTable />

@code
{
    private List<FileSystemInfo> Items = new List<FileSystemInfo>();

    protected override void OnInitialized()
    {
        base.OnInitialized();

        RefreshExplorerView();
        meddyExplorerSessionInfo.OnCurrentDirChanged += OnCurrentDirChanged;
    }

    protected void RefreshExplorerView()
    {
        Items.Clear();

        string[] subfolderPaths = Directory.GetDirectories(meddyExplorerSessionInfo.CurrentDir.FullName);
        foreach (string subfolderPath in subfolderPaths)
        {
            Items.Add(new DirectoryInfo(subfolderPath));
        }

        string[] filePaths = Directory.GetFiles(meddyExplorerSessionInfo.CurrentDir.FullName);
        foreach (string filePath in filePaths)
        {
            Items.Add(new FileInfo(filePath));
        }
    }

    protected void OnCurrentDirChanged(DirectoryInfo inOldCurrentDir, DirectoryInfo inNewCurrentDir)
    {
        RefreshExplorerView();
        StateHasChanged();
    }

    protected void ItemRowClickEvent(TableRowClickEventArgs<FileSystemInfo> tableRowClickEventArgs)
    {
        DirectoryInfo folderInfo = tableRowClickEventArgs.Item as DirectoryInfo;
        if (folderInfo is not null)
        {
            meddyExplorerSessionInfo.CurrentDir = folderInfo;
        }
    }
}
