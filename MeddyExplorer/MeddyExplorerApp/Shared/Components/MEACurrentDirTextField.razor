@using MeddyExplorerApp.Services;
@inject MeddyExplorerState meddyExplorerState
@implements IDisposable

<MudTextField @ref="@TextField" T="string" Text="@meddyExplorerState.CurrentDir.FullName" Variant="@Variant.Outlined" Margin="@Margin.Dense" ValueChanged="@OnValueChanged" />

@code
{
    MudTextField<string> TextField { get; set; }

    protected override void OnInitialized()
    {
        meddyExplorerState.OnCurrentDirChangedDelegate += OnCurrentDirChange;
    }

    public void OnCurrentDirChange(DirectoryInfo inOldCurrentDir, DirectoryInfo inNewCurrentDir)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        meddyExplorerState.OnCurrentDirChangedDelegate -= OnCurrentDirChange;
    }

    protected async Task OnValueChanged(string inNewValue)
    {
        if (Directory.Exists(inNewValue))
        {
            meddyExplorerState.CurrentDir = new DirectoryInfo(inNewValue);
            if (TextField is not null)
            {
                await TextField.Clear();
                await TextField.BlurAsync();
            }
        }

    }
}
