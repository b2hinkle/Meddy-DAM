@using MeddyExplorerApp.Objects
@inject MeddyExplorerSessionInfo meddyExplorerSessionInfo

<MudTextField @ref="@TextField" T="string" Text="@meddyExplorerSessionInfo.CurrentDir.FullName" Variant="@Variant.Outlined" Margin="@Margin.Dense" ValueChanged="@OnValueChanged" />

@code
{
    MudTextField<string> TextField { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        meddyExplorerSessionInfo.OnCurrentDirChanged += OnCurrentDirChanged;
    }

    protected void OnCurrentDirChanged(DirectoryInfo inOldCurrentDir, DirectoryInfo inNewCurrentDir)
    {
        StateHasChanged();
    }

    protected async Task OnValueChanged(string inNewValue)
    {
        // Change current directory
        if (Directory.Exists(inNewValue))
        {
            meddyExplorerSessionInfo.CurrentDir = new DirectoryInfo(inNewValue);
        }

        if (TextField is not null)
        {
            await TextField.Clear();
            await TextField.BlurAsync();
        }
    }
}
